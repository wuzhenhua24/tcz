# 1 Scope 范围总结分析

## 文档信息
- **文档编号**: 3GPP TS 24.501 version 18.12.0 Release 18
- **发布日期**: 2024-09
- **页码**: 第27页
- **所属章节**: 1 Scope（范围）

## 核心内容：文档范围界定

### 文档的技术范围
本文档规定了在 **UE（User Equipment，用户设备）** 和 **5GC（5G Core network，5G 核心网）** 之间，**5GS（5G System，5G 系统）** 的 **第三层 NAS（Non-Access Stratum，非接入层）** 支持。

### 5GS 控制平面的第三层支持架构

在 5GS 的控制平面中，第三层支持由 **NAS 协议** 提供，包含两个关键的协议路径：

#### 1. UE ↔ AMF 之间的 NAS 协议
- **功能定位**: 移动性管理（Mobility Management, MM）
- **协议层次**: 第三层（Layer 3）
- **通信实体**:
  - UE (User Equipment) - 用户设备
  - AMF (Access and Mobility Management Function) - 接入和移动性管理功能

#### 2. UE ↔ SMF 之间的 NAS 协议
- **功能定位**: 会话管理（Session Management, SM）
- **协议层次**: 第三层（Layer 3）
- **通信实体**:
  - UE (User Equipment) - 用户设备
  - SMF (Session Management Function) - 会话管理功能

## 技术架构详解

### 什么是 NAS (Non-Access Stratum)？

**NAS 的层次定位**

在移动通信协议栈中，协议分为两大层次：
- **AS (Access Stratum, 接入层)**: 负责无线资源管理、物理层传输等与无线接入相关的功能
- **NAS (Non-Access Stratum, 非接入层)**: 独立于接入技术，负责移动性管理和会话管理等核心网功能

```
用户设备 (UE)                               5G 核心网 (5GC)
+------------------+                    +-------------------+
|                  |                    |                   |
|   应用层         |                    |   应用层          |
|                  |                    |                   |
+------------------+                    +-------------------+
|                  |                    |                   |
|   NAS 层         |<------------------>|   AMF / SMF       |
|  (Layer 3)       |   NAS 协议         |   (Layer 3)       |
|                  |                    |                   |
+------------------+                    +-------------------+
|                  |                    |                   |
|   AS 层          |<------------------>|   接入网 (RAN)    |
| (Layer 1/2/3)    |   无线接口         |   (Layer 1/2/3)   |
|                  |                    |                   |
+------------------+                    +-------------------+
```

**NAS 的关键特性**
- **接入独立性**: NAS 协议独立于底层的接入技术（5G NR、LTE、Wi-Fi等）
- **端到端通信**: NAS 消息在 UE 和核心网网元之间端到端传输
- **透明传输**: NAS 消息通过接入网（RAN）透明传输，RAN 不解析 NAS 消息内容

### 5GS 控制平面的双协议架构

#### 移动性管理 (MM) - UE ↔ AMF

**主要功能**
- **注册管理**: UE 接入网络的注册、注销流程
- **连接管理**: NAS 信令连接的建立和释放
- **可达性管理**: 跟踪 UE 的位置，确保网络可以找到 UE
- **移动性管理**: 处理 UE 在网络中移动时的切换和位置更新
- **安全管理**: NAS 层的认证、加密和完整性保护
- **标识管理**: SUPI/SUCI/GUTI 等标识的管理

**典型流程**
```
UE                           AMF
 |                            |
 |--- 注册请求 (Registration Request) --->|
 |                            |
 |<-- 认证请求 (Authentication Request) ---|
 |                            |
 |--- 认证响应 (Authentication Response) -->|
 |                            |
 |<-- 安全模式命令 (Security Mode Command) ---|
 |                            |
 |--- 注册完成 (Registration Complete) --->|
 |                            |
```

#### 会话管理 (SM) - UE ↔ SMF

**主要功能**
- **PDU 会话建立**: 建立数据传输所需的 PDU 会话
- **PDU 会话修改**: 修改现有会话的 QoS、路由等参数
- **PDU 会话释放**: 释放不再需要的 PDU 会话
- **QoS 管理**: 服务质量参数的协商和管理
- **会话连续性**: 保证 UE 移动时会话的连续性

**典型流程**
```
UE                           SMF
 |                            |
 |--- PDU 会话建立请求 (PDU Session Establishment Request) --->|
 |                            |
 |<-- PDU 会话建立接受 (PDU Session Establishment Accept) ---|
 |                            |
 |   (数据传输)                |
 |                            |
 |--- PDU 会话释放请求 (PDU Session Release Request) --->|
 |                            |
 |<-- PDU 会话释放命令 (PDU Session Release Command) ---|
 |                            |
```

### 为什么需要分离 MM 和 SM？

**架构解耦的优势**

1. **功能独立性**
   - 移动性管理和会话管理可以独立演进
   - 不同的网元可以独立扩展

2. **灵活部署**
   - AMF 和 SMF 可以部署在不同的物理位置
   - 可以根据负载特点独立扩容

3. **网络切片支持**
   - 不同的网络切片可以有不同的 SMF
   - 统一的 AMF 管理所有切片的移动性

4. **服务化架构**
   - 符合 5GC 的 SBA (Service-Based Architecture) 设计理念
   - 网元之间通过服务接口交互

## 技术意义与应用

### 1. 协议范围的明确界定

**为什么需要明确 Scope？**

**标准化边界清晰**
- 明确本文档覆盖的技术内容范围
- 避免与其他规范的重叠和冲突
- 帮助读者快速判断是否是所需文档

**实现指导明确**
- 设备厂商清楚需要实现哪些协议
- 测试机构知道应该测试哪些功能
- 网络规划者了解系统能力边界

### 2. 与其他 3GPP 规范的关系

本文档（TS 24.501）聚焦于 NAS 协议，与其他规范形成配合：

**相关规范矩阵**

| 规范编号 | 规范名称 | 覆盖范围 | 与 TS 24.501 的关系 |
|---------|---------|---------|-------------------|
| TS 38.300 | NR 总体架构 | 5G NR 整体架构 | 提供系统架构背景 |
| TS 23.501 | 5GS 系统架构 | 5GS 架构和流程 | 定义 NAS 协议的使用场景 |
| TS 24.501 | 5GS NAS 协议 | NAS 消息和流程 | **本文档** |
| TS 38.331 | RRC 协议 | 无线资源控制 | AS 层协议，与 NAS 配合 |
| TS 33.501 | 5GS 安全 | 安全架构和流程 | 定义 NAS 安全机制 |
| TS 29.502 | AMF 服务 | AMF 的 SBI 接口 | AMF 侧的服务接口 |
| TS 29.502 | SMF 服务 | SMF 的 SBI 接口 | SMF 侧的服务接口 |

**协议栈分层关系**

```
应用层协议                                    (不在 TS 24.501 范围内)
--------------------------------------------------------------------
NAS 协议 (MM)      [TS 24.501 第5章]         UE ↔ AMF
NAS 协议 (SM)      [TS 24.501 第6章]         UE ↔ SMF
--------------------------------------------------------------------
RRC 协议           [TS 38.331]               UE ↔ gNB (AS 层)
PDCP/RLC/MAC/PHY   [TS 38.3xx]               物理层和链路层
--------------------------------------------------------------------
```

### 3. 5GS 与 EPS (4G) 的演进对比

**4G EPS 的 NAS 架构**
- **单一协议路径**: UE ↔ MME
- **功能耦合**: MM 和 SM 功能都在 MME 中处理
- **规范**: TS 24.301 (EPS NAS)

**5GS 的演进改进**
- **双协议路径**: UE ↔ AMF (MM) 和 UE ↔ SMF (SM)
- **功能解耦**: MM 和 SM 分离到不同网元
- **更好的扩展性**: 支持网络切片、边缘计算等新特性

**迁移兼容性**
- 5G UE 需要支持 5GS NAS (TS 24.501)
- 可能还需要支持 EPS NAS (TS 24.301) 实现互操作
- TS 24.501 第4章定义了与 EPS 的互操作流程

## 对开发者和实现者的意义

### 1. UE 侧实现要点

**必须实现的功能模块**

```
UE NAS 协议栈
├── MM 功能 (与 AMF 交互)
│   ├── 注册管理 (Registration Management)
│   ├── 连接管理 (Connection Management)
│   ├── 移动性管理 (Mobility Management)
│   ├── 安全管理 (Security Management)
│   └── 标识管理 (Identity Management)
│
└── SM 功能 (与 SMF 交互)
    ├── PDU 会话管理 (PDU Session Management)
    ├── QoS 管理 (QoS Management)
    └── 会话连续性 (Session Continuity)
```

**实现建议**
- **模块化设计**: MM 和 SM 功能独立模块，便于维护
- **状态机管理**: NAS 协议是状态驱动的，需要精确的状态机实现
- **消息编解码**: 实现完整的 NAS 消息编解码器（参考 TS 24.501 第8章）
- **定时器管理**: NAS 协议定义了多个定时器，需要准确实现
- **安全上下文**: 正确管理 NAS 安全上下文，包括密钥、算法等

### 2. 网络侧实现要点

**AMF 实现要点**
- 实现完整的 MM 功能
- 支持多种注册类型（初始注册、移动性注册、周期性注册等）
- 实现 NAS 安全功能（认证、加密、完整性保护）
- 支持与 SMF 的协同（N11 接口）
- 支持与 UDM、AUSF 等网元的交互

**SMF 实现要点**
- 实现完整的 SM 功能
- 支持多种 PDU 会话类型（IPv4、IPv6、Ethernet、Unstructured）
- 实现 QoS 流管理
- 支持与 UPF 的协同（N4 接口）
- 支持会话连续性（SSC）模式

### 3. 测试验证策略

**协议一致性测试 (Protocol Conformance Testing)**

测试 UE 或网元是否符合 TS 24.501 的协议定义：

**MM 功能测试用例**
- 注册流程测试（正常流程、异常流程）
- 去注册流程测试
- 服务请求流程测试
- 认证流程测试
- 安全模式控制测试
- 移动性管理测试

**SM 功能测试用例**
- PDU 会话建立测试（不同 SSC 模式）
- PDU 会话修改测试
- PDU 会话释放测试
- QoS 流管理测试
- 异常处理测试

**互操作性测试 (Interoperability Testing)**

测试不同厂商设备之间的互操作：
- UE 与不同厂商 AMF 的互操作
- UE 与不同厂商 SMF 的互操作
- 多厂商混合组网场景测试

**工具和方法**
- **协议分析仪**: 捕获和分析 NAS 消息
- **测试系统**: 模拟 AMF/SMF 或 UE 进行测试
- **日志分析**: 分析 NAS 协议交互日志

### 4. 常见实现挑战

**挑战一：NAS 消息的正确编解码**

NAS 消息采用 TLV (Type-Length-Value) 编码格式，规则复杂：
- IE (Information Element) 有多种编码类型
- 可选 IE 和条件 IE 的处理
- 消息长度计算的正确性

**解决方案**
- 使用代码生成工具自动生成编解码代码
- 进行充分的单元测试
- 使用 Wireshark 等工具验证编码正确性

**挑战二：状态机的精确实现**

NAS 协议定义了复杂的状态机：
- MM 状态机（RM 状态、CM 状态）
- SM 状态机（PDU 会话状态）
- 状态转换条件复杂

**解决方案**
- 使用状态机框架或代码生成工具
- 绘制详细的状态转换图
- 进行充分的状态机测试

**挑战三：与 EPS 的互操作**

支持 5GS 和 EPS 互操作的 UE 需要：
- 同时实现 5GS NAS 和 EPS NAS
- 正确处理系统间切换
- 管理双系统的安全上下文

**解决方案**
- 参考 TS 24.501 第4章的互操作流程
- 进行充分的互操作测试
- 关注 3GPP 的互操作测试规范

**挑战四：安全实现的正确性**

NAS 安全至关重要：
- 认证算法的实现
- 加密和完整性保护算法
- 密钥派生
- 安全上下文管理

**解决方案**
- 使用经过验证的密码库
- 严格遵循 TS 33.501 的安全规范
- 进行安全审计和渗透测试

## 文档结构预览

基于 Scope 的定义，TS 24.501 的主要章节结构：

```
TS 24.501 文档结构
│
├── 1. Scope (范围) ← 当前章节
├── 2. References (参考文献)
├── 3. Definitions, symbols and abbreviations (定义、符号和缩写)
├── 4. General (总则)
│   ├── 4.1 General
│   ├── 4.2 EPS interworking (与 EPS 互操作)
│   └── ...
│
├── 5. 5GMM (5G Mobility Management，5G 移动性管理)
│   ├── 5.1 General
│   ├── 5.2 Registration management
│   ├── 5.3 De-registration
│   ├── 5.4 Service request
│   ├── 5.5 Connection management
│   ├── 5.6 Mobility management
│   └── ...
│
├── 6. 5GSM (5G Session Management，5G 会话管理)
│   ├── 6.1 General
│   ├── 6.2 PDU session establishment
│   ├── 6.3 PDU session modification
│   ├── 6.4 PDU session release
│   └── ...
│
├── 7. Message functional definitions and contents (消息功能定义和内容)
│   ├── 7.1 General
│   ├── 7.2 5GMM messages
│   └── 7.3 5GSM messages
│
├── 8. Message format and information elements coding (消息格式和 IE 编码)
│   ├── 8.1 General
│   ├── 8.2 5GMM message format
│   └── 8.3 5GSM message format
│
└── Annexes (附录)
    ├── Annex A: Examples (示例)
    ├── Annex B: Timers (定时器)
    └── ...
```

## 实践应用场景

### 场景一：开发 5G UE 的 NAS 协议栈

**项目启动阶段**
1. **理解 Scope**: 明确需要实现 UE ↔ AMF 和 UE ↔ SMF 的 NAS 协议
2. **架构设计**: 设计 MM 模块和 SM 模块的架构
3. **接口定义**: 定义 NAS 与 AS 层的接口（参考 TS 24.501 第4章）

**开发阶段**
1. **MM 功能开发**: 按照第5章实现注册、连接、移动性管理
2. **SM 功能开发**: 按照第6章实现 PDU 会话管理
3. **消息编解码**: 按照第8章实现消息编解码器

**测试阶段**
1. **单元测试**: 测试各个功能模块
2. **集成测试**: 测试 MM 和 SM 的协同
3. **互操作测试**: 与真实网络或测试系统互操作

### 场景二：开发 5G 核心网（AMF/SMF）

**AMF 开发**
```
功能模块                          对应 TS 24.501 章节
├── 注册管理                      → 5.2
├── 去注册                        → 5.3
├── 服务请求                      → 5.4
├── 连接管理                      → 5.5
├── 移动性管理                    → 5.6
├── NAS 安全                      → 5.4.2 (认证), 5.4.3 (安全模式)
└── 消息处理                      → 7.2 (消息定义), 8.2 (消息编码)
```

**SMF 开发**
```
功能模块                          对应 TS 24.501 章节
├── PDU 会话建立                  → 6.2
├── PDU 会话修改                  → 6.3
├── PDU 会话释放                  → 6.4
├── QoS 管理                      → 6.2.7
└── 消息处理                      → 7.3 (消息定义), 8.3 (消息编码)
```

### 场景三：网络规划和部署

**容量规划**
- **AMF 容量**: 基于注册 UE 数量、移动性频率
- **SMF 容量**: 基于 PDU 会话数量、会话建立频率

**性能优化**
- **NAS 消息优化**: 减少不必要的 NAS 消息交互
- **定时器调优**: 根据网络特点调整 NAS 定时器参数
- **负载均衡**: 在多个 AMF/SMF 之间进行负载均衡

### 场景四：故障排查

**问题：UE 无法注册到网络**

**排查步骤**
1. **检查 NAS 消息**: 使用协议分析仪查看 UE 和 AMF 之间的 NAS 消息
2. **分析注册流程**: 对照 TS 24.501 第 5.2 章的注册流程
3. **检查拒绝原因**: 如果注册被拒绝，分析 5GMM cause 值（参考 TS 24.501 附录 A）
4. **检查安全流程**: 确认认证和安全模式控制流程正确

**问题：PDU 会话建立失败**

**排查步骤**
1. **检查 SM 消息**: 查看 UE 和 SMF 之间的 NAS 消息
2. **分析会话建立流程**: 对照 TS 24.501 第 6.2 章
3. **检查拒绝原因**: 分析 5GSM cause 值
4. **检查 QoS 参数**: 确认 QoS 参数配置正确

## 关键术语解释

### 核心网元

| 术语 | 全称 | 功能 |
|-----|------|------|
| **UE** | User Equipment | 用户设备（如手机） |
| **AMF** | Access and Mobility Management Function | 接入和移动性管理功能 |
| **SMF** | Session Management Function | 会话管理功能 |
| **UPF** | User Plane Function | 用户面功能 |
| **UDM** | Unified Data Management | 统一数据管理 |
| **AUSF** | Authentication Server Function | 认证服务器功能 |

### 协议术语

| 术语 | 全称 | 含义 |
|-----|------|------|
| **NAS** | Non-Access Stratum | 非接入层 |
| **AS** | Access Stratum | 接入层 |
| **MM** | Mobility Management | 移动性管理 |
| **SM** | Session Management | 会话管理 |
| **5GMM** | 5G Mobility Management | 5G 移动性管理 |
| **5GSM** | 5G Session Management | 5G 会话管理 |

### 会话相关

| 术语 | 全称 | 含义 |
|-----|------|------|
| **PDU** | Protocol Data Unit | 协议数据单元 |
| **PDU Session** | PDU Session | PDU 会话，5G 中数据连接的基本单位 |
| **SSC** | Session and Service Continuity | 会话和服务连续性 |
| **QoS** | Quality of Service | 服务质量 |

## 与其他章节的关联

### 前置章节
- **01 Intellectual Property Rights**: 知识产权声明
- **02 Legal Notice**: 法律声明
- **03 Modal Verbs Terminology**: 情态动词术语
- **04 Foreword**: 前言，版本管理说明

### 后续章节预览
- **2 References**: 列出所有引用的 3GPP 和其他标准
- **3 Definitions**: 定义本文档使用的术语
- **4 General**: 总体说明，包括与 EPS 互操作
- **5 5GMM**: 详细定义移动性管理流程（本 Scope 提及的 MM 功能）
- **6 5GSM**: 详细定义会话管理流程（本 Scope 提及的 SM 功能）
- **7-8**: 消息定义和编码规则

## 关键要点总结

1. **文档范围明确** - TS 24.501 专注于 5GS 的 NAS 层协议
2. **双协议架构** - UE ↔ AMF (MM) 和 UE ↔ SMF (SM) 两条协议路径
3. **功能分离** - 移动性管理和会话管理功能分离到不同网元
4. **控制平面定位** - NAS 协议属于控制平面，不涉及用户数据传输
5. **第三层协议** - NAS 是 OSI 七层模型中的第三层（网络层）协议

## 实践建议

### 对于标准研读者
- **从 Scope 开始**: 确认 TS 24.501 是你需要的文档
- **理解双协议架构**: MM 和 SM 是本文档的两大核心内容
- **关注章节关系**: Scope 定义的范围在第 5、6 章中详细展开

### 对于产品开发者
- **架构设计**: 根据 MM/SM 分离的原则设计系统架构
- **接口定义**: 明确 UE 与 AMF、UE 与 SMF 的接口
- **模块化实现**: MM 和 SM 功能独立开发，便于测试和维护

### 对于网络规划者
- **理解协议路径**: UE 需要同时与 AMF 和 SMF 交互
- **容量规划**: AMF 和 SMF 的容量需求不同，需分别规划
- **部署灵活性**: AMF 和 SMF 可以独立部署和扩容

### 对于测试工程师
- **测试范围**: MM 功能和 SM 功能需要分别测试
- **测试工具**: 需要能够模拟 AMF 和 SMF 的测试系统
- **互操作测试**: 关注 UE 与不同厂商 AMF/SMF 的互操作

## 学习路径建议

### 初学者路径
```
1. 理解 Scope (本章) → 明确学习范围
   ↓
2. 阅读 TS 23.501 → 理解 5GS 系统架构
   ↓
3. 学习第 3 章 → 掌握术语定义
   ↓
4. 学习第 5 章 → 理解 MM 功能（建议先学习 5.2 注册管理）
   ↓
5. 学习第 6 章 → 理解 SM 功能（建议先学习 6.2 会话建立）
   ↓
6. 学习第 7-8 章 → 掌握消息格式和编码
```

### 开发者路径
```
1. Scope + 系统架构 (TS 23.501) → 架构设计
   ↓
2. 第 4 章 (General) → 理解总体要求
   ↓
3. 第 5 章或第 6 章（根据开发模块）→ 详细设计
   ↓
4. 第 7-8 章 → 实现消息编解码
   ↓
5. 附录 B (Timers) → 实现定时器
   ↓
6. 安全相关章节 + TS 33.501 → 实现安全功能
```

### 测试工程师路径
```
1. Scope + 系统架构 → 理解测试范围
   ↓
2. 第 5 章 MM 流程 → 设计 MM 测试用例
   ↓
3. 第 6 章 SM 流程 → 设计 SM 测试用例
   ↓
4. 第 7-8 章 → 理解消息格式，设计消息验证测试
   ↓
5. 异常处理章节 → 设计异常测试用例
```

## 参考资源

### 相关 3GPP 规范
- **TS 23.501**: 5GS 系统架构（必读）
- **TS 33.501**: 5GS 安全架构和流程
- **TS 38.331**: RRC 协议（AS 层，与 NAS 配合）
- **TS 29.502**: AMF 服务接口
- **TS 29.503**: UDM 服务接口

### 学习资源
- **3GPP 官方网站**: https://www.3gpp.org
- **规范下载**: https://www.3gpp.org/DynaReport/24501.htm
- **在线培训**: 3GPP 和各大培训机构提供的 5G NAS 培训课程

### 工具推荐
- **Wireshark**: 协议分析工具，支持 5G NAS 解码
- **ASN.1 编译器**: 用于生成消息编解码代码
- **协议测试仪**: Keysight、R&S 等厂商的协议测试设备

## 总结

Scope 章节虽然简短，但明确界定了 TS 24.501 的核心范围：
- **技术定位**: 5GS 的第三层 NAS 协议
- **协议架构**: UE ↔ AMF (MM) 和 UE ↔ SMF (SM) 双协议路径
- **功能范围**: 移动性管理和会话管理

这个清晰的范围定义为后续章节的详细规范奠定了基础，也为开发者、测试工程师和网络规划者提供了明确的指导。理解 Scope 是深入学习 TS 24.501 的第一步，也是正确实现 5G NAS 协议的基础。
